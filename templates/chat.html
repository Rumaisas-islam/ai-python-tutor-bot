{% extends "base.html" %}
{% block content %}
<div class="chat-box">
    <p style="color:#00ffcc; text-align:center; margin-bottom: 10px;">
    üí° Type <strong>'hi'</strong> to begin and explore learning options!
    </p>
    <h2>Ask anything about Python üë®‚Äçüíª</h2>
    <div id="chat-log">
        {% for c in chats %}
            <div class="chat-entry">
                <p class="user-msg"><strong>You:</strong> {{ c.user_message }}</p>
                <p class="bot-msg"><strong>Bot:</strong> {{ c.bot_response }}</p>
            </div>
        {% endfor %}
    </div>
    <form id="chat-form" method="POST">
        <input type="text" name="message" placeholder="Type your Python question..." required>
        <button type="submit">Send</button>
    </form>
    <a href="{{ url_for('logout') }}" class="logout">Logout</a>
</div>

<script>
document.getElementById("chat-form").onsubmit = async function(e) {
    e.preventDefault();
    const message = this.message.value;
    const res = await fetch("/", {
        method: "POST",
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: "message=" + encodeURIComponent(message)
    });
    const data = await res.json();
    const log = document.getElementById("chat-log");
    log.innerHTML += `
        <div class="chat-entry">
            <p class="user-msg"><strong>You:</strong> ${message}</p>
            <p class="bot-msg"><strong>Bot:</strong> ${data.response.replace(/\n/g, '<br>')}</p>
        </div>`;
    this.message.value = "";
};
</script>
{% endblock %}
